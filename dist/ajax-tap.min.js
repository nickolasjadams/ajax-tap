"use strict";function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey(arg){arg=_toPrimitive(arg,"string");return"symbol"===_typeof(arg)?arg:String(arg)}function _toPrimitive(input,hint){if("object"!==_typeof(input)||null===input)return input;var prim=input[Symbol.toPrimitive];if(prim===undefined)return("string"===hint?String:Number)(input);input=prim.call(input,hint||"default");if("object"!==_typeof(input))return input;throw new TypeError("@@toPrimitive must return a primitive value.")}
/**
 * AjaxTap.js
 * 
 * Listen in on any trusted XHR's made on your webpage.
 * Run functions when your conditions are met.
 * 
 * @author Nick Adams
 * @see {@link https://github.com/nickolasjadams/ajax-tap|Repository}
 * @license MIT
 * @version 1.0.4
 */var AjaxTap=function(){function AjaxTap(){_classCallCheck(this,AjaxTap),this.responseEvents=[],this.dev=!1}return _createClass(AjaxTap,[{key:"addResponseEvent",value:function(options){if(!options)throw new Error("Event options are required.");if(!options.conditions)throw new Error("Event conditions are required.");var responseEvent;if(options.fire)return(responseEvent={trustedMessengers:[],conditions:null,fire:null}).trustedMessengers.push(window.location.origin),options.trustedMessengers&&options.trustedMessengers.forEach(function(messenger){responseEvent.trustedMessengers.push(messenger)}),responseEvent.conditions=options.conditions,responseEvent.fire=options.fire,this.responseEvents.push(responseEvent),this;throw new Error("Event must have something to fire in response to met conditions.")}},{key:"listen",value:function(){if(0==this.responseEvents.length)throw new Error("This tap has no response events to listen to.");try{var _this=this,origOpen=XMLHttpRequest.prototype.open;XMLHttpRequest.prototype.open=function(){this.addEventListener("load",function(){var _this2=this,matched=!1,origin=AjaxTap.url(this.responseURL).origin;_this.responseEvents.forEach(function(e){var contentType,data;matched||!e.trustedMessengers.some(function(messenger){return origin.includes(messenger)})||(contentType=_this2.getResponseHeader("content-type")||_this2.getResponseHeader("Content-Type"))||(contentType.includes("json")?data=JSON.parse(_this2.responseText):contentType.includes("html")?data=(new DOMParser).parseFromString(_this2.responseText,"text/html"):contentType.includes("xml")?data=_this2.responseXML:contentType.includes("text")&&(data=_this2.responseText),e.conditions(data)&&(matched=!0,e.fire(data)))})}),origOpen.apply(this,arguments)}}catch(e){dev&&console.error(e)}}}],[{key:"url",value:function(str){var a=document.createElement("a"),str=(a.setAttribute("href",str),a.protocol+"//"+a.hostname),host=(0<a.port.length&&(str="".concat(str,":").concat(a.port)),a.host);return{origin:str,host:host,hostname:a.hostname,pathname:a.pathname,port:a.port,protocol:a.protocol,search:a.search,hash:a.hash}}}]),AjaxTap}();